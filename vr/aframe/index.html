<!DOCTYPE html>

<html>
  <head>
    <script src="https://aframe.io/releases/0.5.0/aframe.min.js"></script>
    <script src="components/foes.js"></script>
    <script src="components/waypoints.js"></script>
    <script src="https://rawgit.com/chenzlabs/auto-detect-controllers/master/dist/aframe-auto-detect-controllers-component.min.js"></script>
    <script src="https://rawgit.com/chenzlabs/gearvr-controls/master/dist/aframe-gearvr-controls-component.min.js"></script>
    <script>
        AFRAME.registerComponent( 'spawnsOnClick', {
          getRandomPosition: function() {
            var position = { x:0, y:0, z:0 };
            var maxNodeX = 4;
            var maxNodeY = 4;
            var maxNodeZ = 4;
            position.x = Math.floor( ( Math.random() * 2*maxNodeX ) - maxNodeX );
            position.y = Math.floor( ( Math.random() * maxNodeY ) - maxNodeY ); //Can be negative XZ coords, but only +y.
            position.z = Math.floor( ( Math.random() * 2*maxNodeZ ) - maxNodeZ );
            return position;
          },
          spawn: function() { 
            var newFoe = this.el.sceneEl.components.pool__foes.requestEntity(); 
            newfoe.setAttribute( 'position', this.getRandomPosition() );
          },
          init: function() { 
            this._t = this;
            this.el.addEventListener( 'click', this.spawn  ); 
          },
          tick: function() {
            //On enemy death, return to pool of enemies.
          },
        } );
    </script>
  </head>
  
  <body>
    <a-scene pool_foes="mixin:foePrefab; size: 5" pool__combatNodes="mixin:combatNodePrefabMesh combatNodePrefabMaterial; size:10" pool__waypoints="mixin:waypointPrefabMesh waypointPrefabMaterial; size:10">
      <a-assets>
        <a-mixin id="gazetimerFoePrefab" 
                 text="value:Rawr, I'm a gazetimer monster;
                       color:red"
                 foe="numNodes:3;
                   nodePopSFX:assets/Amalgamate.wav;
                   dieSFX:assets/Shinsei by Gichco.mp3;
                   nodeGazeTimeMilliseconds:3000.0"></a-mixin>
        
        <a-mixin id="popcornFoePrefab" 
                 text="value:Rawr, I'm a popcorn monster;
                       color:red"
                 foe="numNodes:3;
                   nodePopSFX:assets/Amalgamate.wav;
                   dieSFX:assets/Shinsei by Gichco.mp3"></a-mixin>
        
        <a-mixin id="combatNodePrefabMesh" geometry="primitive:sphere;width:4;height:1"></a-mixin>
        <a-mixin id="combatNodePrefabMaterial" material="color:#FFF" ></a-mixin>
        <a-mixin id="waypointPrefabMesh" geometry="primitive:cylinder;height:1;radius:2"></a-mixin>
        <a-mixin id="waypointPrefabMaterial" material="color:green"></a-mixin>
        
        <img id="skyTexture" src="assets/reactvr-meshsample/chess-world.jpg"/>
        
      </a-assets>

      <a-sky src="#skyTexture"></a-sky>
      
      <a-entity spawnsOnClick geometry="primitive:dodecahedron;radius:2" material="color:red" position="0 2 -5"></a-entity>
      
      <a-plane class="floor" position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="#7BC8A4"></a-plane>
      
      <!-- If detected, will use built-in controller model (e.g. Oculus Touch or Vive) -->
     <a-entity id="lefthand" auto-detect-controllers="hand:left"></a-entity>
     <a-entity id="righthand" auto-detect-controllers="hand:right"></a-entity>
      
      <a-camera>
        <a-entity position="0 0 -1" cursor cursor-listener raycaster="objects: .floor"
                  event-set__1="_event: onSwapToFoesWorld; raycaster.objects: .waypoint"
                  event-set__2="_event: onSwapToKeysWorld; raycaster.objects: .floor"
                  geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.02; segmentsTheta: 64"
                  material="opacity: 0.8; shader: flat; color: #000"></a-entity>
      </a-camera>
    </a-scene>
  </body>
</html>
