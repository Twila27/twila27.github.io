<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.7/p5.min.js"></script>
<script>
  const btn = document.querySelector('button'),
  chunks = [];

  function record() {
    chunks.length = 0;
    let stream = document.querySelector('canvas').captureStream(30),
      recorder = new MediaRecorder(stream);
    recorder.ondataavailable = e => {
      if (e.data.size) {
        chunks.push(e.data);
      }
    };
    recorder.onstop = exportVideo;
    btn.onclick = e => {
      recorder.stop();
      btn.textContent = 'start recording';
      btn.onclick = record;
    };
    recorder.start();
    btn.textContent = 'stop recording';
  }

  function exportVideo(e) {
    var blob = new Blob(chunks);
    var vid = document.createElement('video');
    vid.id = 'recorded'
    vid.controls = true;
    vid.src = URL.createObjectURL(blob);
    document.body.appendChild(vid);
    vid.play();
  }
  btn.onclick = record;
  
  var angle = 0;
  var radius = 1;
  var canvasWidth = 640;
  var canvasHeight = 480;
  function clearScreen() {
    background(0);
  }
  function setup() { //called once
    createCanvas(canvasWidth, canvasHeight);
    fill(255); //not lines
    stroke(127); //lines and borders
    clearScreen();
  }
  function drawSpiral(centerX, centerY) {
    // x = r * cos(t); y = r * sin(t)
    // future goal: r = a*e^(b*angle) -- a logarithmic spiral
    // so x = ae^bt * cos(t); y = ae^bt * sin(t)
    var polarX = radius * cos(radians(angle)) + centerX;
    var polarY = radius * sin(radians(angle)) + centerY;
    line(centerX, centerY, polarX, polarY);
    ellipse(polarX, polarY, 4, 6);   
  }
  function draw() { //called per frame
    var centerX = canvasWidth/2;
    var centerY = canvasHeight/2;      

    drawSpiral(centerX, centerY);      
    drawSpiral(centerX + width/4, centerY);
    drawSpiral(centerX - width/4, centerY);

    drawSpiral(centerX, centerY - width/4);      
    drawSpiral(centerX + width/4, centerY - width/4);
    drawSpiral(centerX - width/4, centerY - width/4);

    drawSpiral(centerX, centerY + width/4);      
    drawSpiral(centerX + width/4, centerY + width/4);
    drawSpiral(centerX - width/4, centerY + width/4);

    angle += 1;
    radius += .1;
  }
</script>
<button>start recording</button><br>
